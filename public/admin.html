<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>StoreSkull - Admin</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <nav>
    <div class="logo">StoreSkull Admin</div>
  </nav>

  <div class="container">
    <h2>Tambah Produk</h2>
    <input type="text" id="pname" placeholder="Nama Produk">
    <input type="text" id="pprice" placeholder="Harga">
    <button id="addProductBtn">Tambah</button>

    <h2>Kelola Pesanan</h2>
    <div id="ordersList"></div>
  </div>

  <footer>
    &copy; 2025 SKULLHOSTING | StoreSkull
  </footer>

  <script>
    async function loadOrders() {
      const res = await fetch("/api/orders");
      const orders = await res.json();
      const ordersList = document.getElementById("ordersList");
      ordersList.innerHTML = "";
      orders.forEach(o => {
        const div = document.createElement("div");
        div.innerHTML = `
          ${o.product.name} - ${o.username} - ${o.phone} - ${o.status}
          <button onclick="updateOrder(${o.id}, 'done')">Done</button>
          <button onclick="updateOrder(${o.id}, 'cancel')">Batal</button>
        `;
        ordersList.appendChild(div);
      });
    }

    async function updateOrder(id, status){
      await fetch("/api/orders/" + id, {
        method: "PATCH",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ status })
      });
      loadOrders();
    }

    document.getElementById("addProductBtn").onclick = async () => {
      const name = document.getElementById("pname").value;
      const price = document.getElementById("pprice").value;
      if(name && price){
        await fetch("/api/products", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ name, price })
        });
        document.getElementById("pname").value = "";
        document.getElementById("pprice").value = "";
        alert("Produk ditambahkan!");
      }
    }

    loadOrders();
    setInterval(loadOrders, 2000); // real-time update
  </script>
</body>
</html>
